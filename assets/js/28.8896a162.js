(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{182:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",[s._v("เขียนโปรแกรมดาวน์โหลดรูปภาพและวีดีโอด้วย Node.js")]),s._v(" "),a("p",[s._v("Node.js เป็น Framework ที่มีความสามารถด้าน Networking และ Internet พร้อมใช้งานทันทีโดยไม่จำเป็นต้องติดตั้ง Package เพิ่มเติม โดยบทความนี้จะสาธิตการเขียนโปรแกรมสำหรับดาวน์โหลดรูปภาพและวีดีโอโดยการใช้ Core Module ของ Node.js ซึ่งเมื่อเข้าใจหลักการเขียนโปรแกรมตามในบทความแล้ว ผู้อ่านก็จะสามารถนำไปต่อยอดในการเขียนโปรแกรม Web Scraping ได้เช่นกันครับ")]),s._v(" "),a("h3",{attrs:{id:"ลำดับการทำงานของโปรแกรม"}},[s._v("ลำดับการทำงานของโปรแกรม")]),s._v(" "),s._m(0),s._v(" "),a("h3",{attrs:{id:"เตรียมไฟล์สำหรับเขียนโปรแกรม"}},[s._v("เตรียมไฟล์สำหรับเขียนโปรแกรม")]),s._v(" "),s._m(1),s._v(" "),s._m(2),s._m(3),s._v(" "),s._m(4),s._m(5),s._v(" "),s._m(6),a("h3",{attrs:{id:"คลังรูปภาพและวีดีโอ"}},[s._v("คลังรูปภาพและวีดีโอ")]),s._v(" "),a("p",[s._v("ตัวอย่างลิงค์สำหรับดาวน์โหลดรูปภาพ ทั้งภาพนิ่ง ภาพเคลื่อนไหว และวีดีโอสามารถหาได้จากเว็บไซต์ "),a("a",{attrs:{href:"https://imgur.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://imgur.com/"),a("OutboundLink")],1),s._v(" ครับ")]),s._v(" "),a("h3",{attrs:{id:"http-request"}},[s._v("HTTP Request")]),s._v(" "),s._m(7),s._v(" "),s._m(8),a("h3",{attrs:{id:"stream-manipulation"}},[s._v("Stream Manipulation")]),s._v(" "),a("p",[s._v("จากขั้นตอนที่ผ่านมา ข้อมูลที่ส่งมาจากจากเซิฟเวอร์นั้น จะถูกส่งมาเป็น Chunk จำนวนหลายครั้ง ในขั้นตอนนี้จะเป็นการนำ Chunk เหล่านั้นมาต่อเติมเป็น Stream ไปเรื่อยๆ ครับ ซึ่ง Node.js ก็มี Core Module รองรับการจัดการกับ Stream ไว้พร้อมแล้วเช่นกันครับ")]),s._v(" "),s._m(9),s._v(" "),s._m(10),a("h3",{attrs:{id:"บันทึก-stream"}},[s._v("บันทึก Stream")]),s._v(" "),s._m(11),s._v(" "),s._m(12),s._v(" "),s._m(13),a("h3",{attrs:{id:"โค้ดทั้งหมด"}},[s._v("โค้ดทั้งหมด")]),s._v(" "),s._m(14),s._v(" "),s._m(15),a("h3",{attrs:{id:"つづく"}},[s._v("つづく")])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[this._v("ส่ง HTTP Request ไปยังเซิร์ฟเวอร์")]),this._v(" "),t("li",[this._v("รับ Raw Data จากเซิร์ฟเวอร์ และนำมา Manipulate Stream")]),this._v(" "),t("li",[this._v("บันทึก Stream ลงดิสก์")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("em",[this._v("Path")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[this._v("\n|-package.json\n+-src\n|   |-index.js\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("package.json")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-json extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[this._v("\n{\n    "),t("span",{staticClass:"hljs-attr"},[this._v('"scripts"')]),this._v(": {\n        "),t("span",{staticClass:"hljs-attr"},[this._v('"dev"')]),this._v(": "),t("span",{staticClass:"hljs-string"},[this._v('"node src"')]),this._v("\n    }\n}\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("พิมพ์คำสั่งที่ "),t("em",[this._v("Terminal")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[this._v("\n# ทดสอบการรันโปรแกรม\nnpm run dev\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("ในการส่ง HTTP Request นั้น เราจะใช้ Module ชื่อ "),a("code",[s._v("https")]),s._v(" ซึ่งเป็น Core Module ที่มาพร้อมกับ Node.js อยู่แล้วครับ ซึ่งคำสั่ง "),a("code",[s._v("https.request()")]),s._v(" ถูก Implement ในรูปแบบของ Callback เราจึงไม่สามารถเขียนโค้ดในแบบ "),a("code",[s._v("async")]),s._v("/"),a("code",[s._v("await")]),s._v(" ได้ครับ")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// เรียกใช้ module")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" https = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'https'")]),s._v(")\n"),a("span",{staticClass:"hljs-comment"},[s._v("// ตัวอย่าง permalink จากเว็บ imgur.com ครับ")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" url = "),a("span",{staticClass:"hljs-string"},[s._v("'https://i.imgur.com/UDkB5M4.mp4'")]),s._v("\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// ส่ง request ไปยังเซิร์ฟเวอร์")]),s._v("\nhttps.request(url, res => {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// เกิด event ระหว่างรับข้อมูลจากเซิร์ฟเวอร์")]),s._v("\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'data'")]),s._v(", chunk => {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n    })\n\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// เกิด event เมื่อรับข้อมูลจากเซิร์ฟเวอร์เสร็จสิ้น")]),s._v("\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'end'")]),s._v(", () => {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'Finished'")]),s._v(")\n    })\n\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// แสดงข้อความ error")]),s._v("\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'error'")]),s._v(", err => {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(err.message)\n    })\n}).end()\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/index.js")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// เรียกใช้ module")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" Stream = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'stream'")]),s._v(").Transform\n\nhttps.request(url, res => {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// สร้าง instance ของ stream")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" stream = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Stream()\n\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'data'")]),s._v(", chunk => {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// รับข้อมูลจากเซิร์ฟเวอร์และต่อเติม Stream ไปเรื่อยๆ")]),s._v("\n        stream.push(chunk)\n    })\n}).end()\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ขั้นตอนสุดท้ายจะเป็นการบันทึก Stream ลงสู่ Disk ซึ่งในขั้นตอนนี้เราจะใช้งาน Core Module ที่ชื่อ "),t("code",[this._v("fs")]),this._v(" ครับ")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/index.js")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// เรียกใช้ module")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" fs = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'fs'")]),s._v(")\n\nhttps.request(url, res => {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// บันทึก stream เมื่อรับข้อมูลจากเซิร์ฟเวอร์เสร็จสิ้น")]),s._v("\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'end'")]),s._v(", () => {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// ใช้ regular expression เพื่อ extract ชื่อไฟล์และนามสกุลจาก url")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" pattern = "),a("span",{staticClass:"hljs-regexp"},[s._v("/(\\w+\\.)+\\w+$/")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" filename = url.match(pattern)["),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]\n\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// เขียน stream ลง disk")]),s._v("\n        fs.writeFileSync(filename, stream)\n    })\n}).end()\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/index.js")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" https = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'https'")]),s._v(")\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" Stream = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'stream'")]),s._v(").Transform\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" fs = "),a("span",{staticClass:"hljs-built_in"},[s._v("require")]),s._v("("),a("span",{staticClass:"hljs-string"},[s._v("'fs'")]),s._v(")\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" url = "),a("span",{staticClass:"hljs-string"},[s._v("'https://i.imgur.com/UDkB5M4.mp4'")]),s._v("\n\nhttps.request(url, res => {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" stream = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Stream()\n\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'data'")]),s._v(", chunk => {\n        stream.push(chunk)\n    })\n\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'end'")]),s._v(", () => {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" pattern = "),a("span",{staticClass:"hljs-regexp"},[s._v("/(\\w+\\.)+\\w+$/")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" filename = url.match(pattern)["),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("]\n\n        fs.writeFileSync(filename, stream)\n    })\n\n    res.on("),a("span",{staticClass:"hljs-string"},[s._v("'error'")]),s._v(", err => {\n        "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(err.message)\n    })\n}).end()\n")])])])}],!1,null,null,null);t.default=e.exports}}]);