(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{210:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",[s._v("Vue.js และการทำ Request Cancellation กับ axios")]),s._v(" "),s._m(0),s._v(" "),a("p",[s._v("เคสตัวอย่างปัญหาเช่น ในการทำระบบแสดงสินค้าตามหมวดหมู่นั้น ในขั้นต้นผู้ใช้อาจจะคลิกเลือกแสดงสินค้าในหมวด A แต่เกิดเปลี่ยนใจกระทันหัน ไปคลิกเลือกแสดงสินค้าในหมวด B แทน ในขณะที่ผลลัพธ์ของหมวด A ยังไม่มีการ Response กลับมา")]),s._v(" "),s._m(1),s._v(" "),a("p",[s._v("ดังนั้นสิ่งที่นักพัฒนาควรทำก็คือให้แอพของเราเพิกเฉยที่จะไปจัดการกับ Response ของ Request ก่อนหน้าทันที ที่มีการส่ง Request ใหม่")]),s._v(" "),a("h3",{attrs:{id:"เตรียมไฟล์สำหรับเขียนโปรแกรม"}},[s._v("เตรียมไฟล์สำหรับเขียนโปรแกรม")]),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._m(6),s._v(" "),s._m(7),s._v(" "),s._m(8),s._m(9),s._v(" "),a("p",[s._v("เพื่อความง่ายในการสาธิต เราจะเพียงแค่ทดลองส่ง Request เรียงลำดับกันจำนวนหนึ่งเพื่อให้เห็นปัญหาว่าการ Response ของผลลัพธ์นั้นอาจจะไม่เรียงลำดับตามลำดับของการส่ง Request เสมอไป โดยเราจะใช้ Backend API ของ "),a("code",[s._v("https://jsonplaceholder.typicode.com")]),s._v(" และใช้ Endpoint คือ "),a("a",{attrs:{href:"https://jsonplaceholder.typicode.com/users",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://jsonplaceholder.typicode.com/users"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://codesandbox.io/s/ll0j51rq39?fontsize=14",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit Vue Template"}}),a("OutboundLink")],1)]),s._v(" "),s._m(10),s._v(" "),s._m(11),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),s._m(16),s._v(" "),s._m(17),s._v(" "),a("p",[a("a",{attrs:{href:"https://codesandbox.io/s/w25j49jk3k?fontsize=14",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit Vue Template"}}),a("OutboundLink")],1)]),s._v(" "),s._m(18),s._v(" "),s._m(19),s._m(20),s._v(" "),s._m(21),s._v(" "),a("h3",{attrs:{id:"โค้ดทั้งหมด"}},[s._v("โค้ดทั้งหมด")]),s._v(" "),s._m(22),s._v(" "),s._m(23),s._m(24),a("h3",{attrs:{id:"つづく"}},[s._v("つづく")])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ปัจจุบันการส่ง "),t("code",[this._v("XMLHttpRequest")]),this._v(" ไปยัง Backend API นั้นเป็นเรื่องพื้นฐานที่มีการใช้งานกันแทบทุกเว็บแอพ แต่ด้วยธรรมชาติของ Asynchronous ใน JavaScript นั้นทำให้การแสดงผลลัพธ์ของ Response อาจไม่เป็นไปตามลับดับในการส่ง Request เสมอไป แล้วถ้าการแสดงผลลัพธ์ของ Response ไม่ได้เป็นไปตามลำดับที่ควรจะเป็นหล่ะ จะเกิดปัญหาอย่างไร")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("สิ่งที่นักพัฒนาอาจจะเข้าใจไปเองคือ เมื่อมีการส่ง Request ครั้งใหม่เกิดขึ้น "),t("code",[this._v("axios")]),this._v(" ก็จะไม่สนใจ Response ของ Request ก่อนหน้านั้นอีก แต่ในความเป็นจริงแล้ว Response ทุกตัวยังคงถูกจัดการตามลำดับของการ Response อยู่ดี (ไม่ใช่ลำดับของการส่ง Request) แสดงว่าหากโชคไม่ดี Response ของสินค้าของหมวด B ดันกลับมาถึงซะก่อน หน้าจอแสดงผลของผู้ใช้จะแสดงผลสินค้าในหมวด A (เพราะดันกลับมาถึงทีหลัง จึงไปแทนที่ผลลัพธ์ที่กลับมาถึงก่อน) ทั้งๆ ที่ผู้ใช้เปลี่ยนใจ และได้คลิกแสดงสินค้าหมวด B ไปแล้ว")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ในตัวอย่างโค้ดของบทความนี้ เราจะเลือกใช้ Vue.js เนื่องจากเป็นไลบรารี่ยอดนิยมและใช้งานง่าย โดยจะใช้ "),t("code",[this._v("axios")]),this._v(" เป็นตัวส่ง "),t("code",[this._v("XMLHttpRequest")]),this._v(" และจัดการกับ Response ครับ")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("axios")]),this._v(" คือไลบรารี่ที่ใช้ในการส่ง "),t("code",[this._v("XMLHttpRequest")]),this._v(" สำหรับการพัฒนาแอพฝั่ง Client และยังสามารถใช้ส่ง HTTP Request สำหรับการพัฒนาแอพด้วย Node.js ด้วยเช่นกันครับ")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("em",[this._v("Path")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[this._v("\n|-package.json\n+-src\n|   |-main.js\n|   |-App.vue\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"ติดตั้ง-axios"}},[this._v("ติดตั้ง "),t("code",[this._v("axios")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("พิมพ์คำสั่งที่ "),t("em",[this._v("Terminal")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[this._v("\nnpm install axios --save\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"ใช้งาน-vue-js-และ-axios"}},[this._v("ใช้งาน Vue.js และ "),t("code",[this._v("axios")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/App.vue")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-html extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-tag"},[s._v("<"),a("span",{staticClass:"hljs-name"},[s._v("button")]),s._v(" @"),a("span",{staticClass:"hljs-attr"},[s._v("click")]),s._v("="),a("span",{staticClass:"hljs-string"},[s._v('"makeMultipleRequests()"')]),s._v(">")]),s._v("Make Multiple Requests"),a("span",{staticClass:"hljs-tag"},[s._v("</"),a("span",{staticClass:"hljs-name"},[s._v("button")]),s._v(">")]),s._v("\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios "),a("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v("\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" endpoint = "),a("span",{staticClass:"hljs-string"},[s._v("'https://jsonplaceholder.typicode.com/users'")]),s._v("\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n    "),a("span",{staticClass:"hljs-attr"},[s._v("methods")]),s._v(": {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("async")]),s._v(" makeRequest(id) {\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" { data } = "),a("span",{staticClass:"hljs-keyword"},[s._v("await")]),s._v(" axios.get("),a("span",{staticClass:"hljs-string"},[s._v("`"),a("span",{staticClass:"hljs-subst"},[s._v("${ endpoint}")]),s._v("/"),a("span",{staticClass:"hljs-subst"},[s._v("${ id }")]),s._v("`")]),s._v(")\n\n            "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("`ID: "),a("span",{staticClass:"hljs-subst"},[s._v("${ data.id }")]),s._v(" Name: "),a("span",{staticClass:"hljs-subst"},[s._v("${ data.name }")]),s._v("`")]),s._v(")\n        },\n\n        makeMultipleRequests() {\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" userIds = ["),a("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),a("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(", "),a("span",{staticClass:"hljs-number"},[s._v("3")]),s._v("]\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// loop เพื่อส่ง request แต่ละ id")]),s._v("\n            userIds.forEach("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("id")]),s._v(" =>")]),s._v(" {\n                "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".makeRequest(id)\n            })\n        }\n    }\n}\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"https://i.imgur.com/gqVscWr.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("จากผลลัพธ์ "),t("code",[this._v("console.log()")]),this._v(" ของตัวอย่างข้างต้นจะเห็นว่าลำดับการกลับมาของ Response นั้น อาจจะไม่ได้เรียงลำดับตามการส่ง Request เสมอไปครับ")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"ใช้งาน-canceltoken"}},[this._v("ใช้งาน "),t("code",[this._v("cancelToken")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("สิ่งที่นักพัฒนาควรทำคือการทำให้ "),a("code",[s._v("axios")]),s._v(" เพิกเฉยกับ Response ของ Request ก่อนหน้าทั้งหมด (Response ยังคงกลับมาตามปกติ เพียงแต่ถูกเพิกเฉยไม่นำผลลัพธ์มาแสดง) ซึ่ง "),a("code",[s._v("axios")]),s._v(" ก็มีตัวช่วยเรื่องนี้ให้เราพร้อมแล้ว โดยใช้หลักการว่าเราสามารถใช้ Object "),a("code",[s._v("CancelToken")]),s._v(" ในการสร้าง "),a("code",[s._v("cancelToken")]),s._v(" เพื่อแนบไปกับ Request ในการส่งแต่ละครั้ง เพื่อให้ "),a("code",[s._v("axios")]),s._v(" สามารถอ้างอิง Request แต่ละตัวได้อย่างถูกต้อง และทุกครั้งที่จะส่ง Request ก็จะตรวจสอบก่อนว่ามี Request ก่อนหน้ารึเปล่า ถ้ามีก็ยกเลิกตัวก่อนหน้า เพราะ "),a("code",[s._v("axios")]),s._v(" รู้จักแล้วว่าตัวไหนคือตัวไหน")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ในขั้นตอนนี้เราจะแก้ไขโค้ดของเราเพียงแค่ Import Object "),t("code",[this._v("CancelToken")]),this._v(" มาใช้ และปรับปรุง Method "),t("code",[this._v("makeRequest()")]),this._v(" ส่วนอื่นๆ เหมือนเดิมทั้งหมดครับ")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/App.vue")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios, { CancelToken } "),a("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v("\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" source\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n    "),a("span",{staticClass:"hljs-attr"},[s._v("methods")]),s._v(": {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("async")]),s._v(" makeRequest(id) {\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// เพิกเฉย request ก่อนหน้า")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (source) {\n                source.cancel()\n            }\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// สร้าง source ใหม่")]),s._v("\n            source = CancelToken.source()\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// รับค่า token จาก source")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" cancelToken = source.token\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// ส่ง request โดยอ้างอิง cancelToken")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" { data } = "),a("span",{staticClass:"hljs-keyword"},[s._v("await")]),s._v(" axios.get("),a("span",{staticClass:"hljs-string"},[s._v("`"),a("span",{staticClass:"hljs-subst"},[s._v("${ endpoint }")]),s._v("/"),a("span",{staticClass:"hljs-subst"},[s._v("${ id }")]),s._v("`")]),s._v(", { cancelToken })\n\n            "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("`ID: "),a("span",{staticClass:"hljs-subst"},[s._v("${data.id}")]),s._v(" Name: "),a("span",{staticClass:"hljs-subst"},[s._v("${data.name}")]),s._v("`")]),s._v(")\n        }\n    }\n}\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"https://i.imgur.com/DlqrD0g.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("จากผลลัพธ์ "),t("code",[this._v("console.log()")]),this._v(" ของตัวอย่างข้างต้นจะเห็นว่า Request ก่อนหน้าทั้งหมดถูกเพิกเฉยแอพจึงแสดงผลลัพธ์ล่าสุดเท่านั้นครับ")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("ไฟล์ "),t("em",[this._v("src/App.vue")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-html extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-tag"},[s._v("<"),a("span",{staticClass:"hljs-name"},[s._v("button")]),s._v(" @"),a("span",{staticClass:"hljs-attr"},[s._v("click")]),s._v("="),a("span",{staticClass:"hljs-string"},[s._v('"makeMultipleRequests()"')]),s._v(">")]),s._v("Make Multiple Requests"),a("span",{staticClass:"hljs-tag"},[s._v("</"),a("span",{staticClass:"hljs-name"},[s._v("button")]),s._v(">")]),s._v("\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js extra-class"},[a("pre",{staticClass:"hljs"},[a("code",[s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios, { CancelToken } "),a("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v("\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" endpoint = "),a("span",{staticClass:"hljs-string"},[s._v("'https://jsonplaceholder.typicode.com/users'")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" source\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n    "),a("span",{staticClass:"hljs-attr"},[s._v("methods")]),s._v(": {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("async")]),s._v(" makeRequest(id) {\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// เพิกเฉย request ก่อนหน้า")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (source) {\n                source.cancel()\n            }\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// สร้าง source ใหม่")]),s._v("\n            source = CancelToken.source()\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// รับค่า token จาก source")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" cancelToken = source.token\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// ส่ง request โดยอ้างอิง cancelToken")]),s._v("\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" { data } = "),a("span",{staticClass:"hljs-keyword"},[s._v("await")]),s._v(" axios.get("),a("span",{staticClass:"hljs-string"},[s._v("`"),a("span",{staticClass:"hljs-subst"},[s._v("${ endpoint }")]),s._v("/"),a("span",{staticClass:"hljs-subst"},[s._v("${ id }")]),s._v("`")]),s._v(", { cancelToken })\n\n            "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("`ID: "),a("span",{staticClass:"hljs-subst"},[s._v("${data.id}")]),s._v(" Name: "),a("span",{staticClass:"hljs-subst"},[s._v("${data.name}")]),s._v("`")]),s._v(")\n        },\n\n        makeMultipleRequests() {\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" userIds = ["),a("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),a("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(", "),a("span",{staticClass:"hljs-number"},[s._v("3")]),s._v("]\n\n            "),a("span",{staticClass:"hljs-comment"},[s._v("// loop เพื่อส่ง request แต่ละ id")]),s._v("\n            userIds.forEach("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("id")]),s._v(" =>")]),s._v(" {\n                "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".makeRequest(id)\n            })\n        }\n    }\n}\n")])])])}],!1,null,null,null);t.default=n.exports}}]);