(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{202:function(s,a,t){"use strict";t.r(a);var v=t(1),l=Object(v.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",[s._v("ตั้งค่า Custom Path ให้กับ โฟลเดอร์ vendor เพื่อใช้งานร่วมกับ Docker")]),s._v(" "),t("p",[s._v("เพื่อความสะดวกในการพัฒนา Application อีกทั้งยังเป็นการปรับปรุงคุณภาพของ Workflow ในขั้นตอนการ Development ปัจจุบันคงไม่มีใครปฎิเสธที่จะใช้งาน Docker และ สำหรับโปรเจค PHP นั้น Docker ช่วยให้พวกเราลดปัญหาเรื่อง Environment จริงตอน Deploy ขึ้น Production ได้เป็นอย่างมาก")]),s._v(" "),t("p",[s._v("ซึ่งการใช้ "),t("code",[s._v("docker-compose")]),s._v(" เพื่อ Setup โปรเจคนั้นเป็นวิธีที่พวกเรานิยมใช้กัน โดยมักจะมีโครงสร้างสำหรับโปรเจค PHP ประมาณนี้")]),s._v(" "),t("p",[t("em",[s._v("Path")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n|-docker-compose.yml\n+-php\n|   |-Dockerfile\n|   +-src\n|   |   |-index.php\n")])])]),t("p",[t("em",[s._v("docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("version:")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"3.3"')]),s._v("\n\n"),t("span",{staticClass:"hljs-attr"},[s._v("services:")]),s._v("\n\n"),t("span",{staticClass:"hljs-attr"},[s._v("    php:")]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("        build:")]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("            context:")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("./php")]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("        container_name:")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("web")]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("        ports:")]),s._v("\n"),t("span",{staticClass:"hljs-bullet"},[s._v("            -")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"80:80"')]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("        restart:")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("always")]),s._v("\n"),t("span",{staticClass:"hljs-attr"},[s._v("        volumes:")]),s._v("\n"),t("span",{staticClass:"hljs-bullet"},[s._v("            -")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("${PROJECT_PATH}/php/src:/var/www/html")]),s._v("\n")])])]),t("p",[s._v("สำหรับโปรเจค PHP นั้นเราต้องการให้โฟลเดอร์ "),t("code",[s._v("vendor")]),s._v(" อยู่ที่ Path "),t("code",[s._v("php/src/vendor")]),s._v(" จึงทำให้เมื่อเราต้องการติดตั้ง Dependencies ยกตัวอย่างเช่น "),t("code",[s._v("slim/slim")]),s._v(" จะต้องทำการเปลี่ยน Path ซะก่อน")]),s._v(" "),t("p",[t("em",[s._v("Terminal")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-built_in"},[s._v("cd")]),s._v(" php/src\ncomposer require slim/slim\n")])])]),t("blockquote",[t("p",[s._v("ปัญหาคือเมื่อเราเปิด Terminal จาก Editor เช่น Visual Studio Code เจ้า Default Working Directory จะอยู่ที่ Root Path ดังนั้นหากเราลืมเปลี่ยน Working Directory จะต้องมาเสียเวลา Cleanup ไฟล์ที่เกิดจากการติดตั้งผิดที่ผิดทาง")])]),s._v(" "),t("h3",{attrs:{id:"ตั้งค่า-custom-path-สำหรับ-vendor"}},[s._v("ตั้งค่า Custom Path สำหรับ "),t("code",[s._v("vendor")])]),s._v(" "),t("p",[s._v("โชคดีที่เราสามารถตั้งค่า Custom Path สำหรับ โฟลเดอร์ "),t("code",[s._v("vendor")]),s._v(" ได้ โดยเราจะเพิ่มไฟล์ "),t("code",[s._v("composer.json")]),s._v(" ไว้ที่ Root Path")]),s._v(" "),t("p",[t("em",[s._v("Path")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n|-composer.json\n|-docker-compose.yml\n+-php\n")])])]),t("p",[t("em",[s._v("composer.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n{\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"config"')]),s._v(": {\n        "),t("span",{staticClass:"hljs-attr"},[s._v('"vendor-dir"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"php/src/vendor"')]),s._v("\n    }\n}\n")])])]),t("p",[s._v("หลังจากทำการตั้งค่า Custom Path ให้กับ "),t("code",[s._v("vendor")]),s._v(" แล้วเราสามารถใช้คำสั่งติดตั้ง Dependencies จาก Root Path ได้เลย")]),s._v(" "),t("p",[t("em",[s._v("Terminal")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\ncomposer require slim/slim\n")])])]),t("h3",{attrs:{id:"ผลลัพธ์"}},[s._v("ผลลัพธ์")]),s._v(" "),t("p",[s._v("โฟลเดอร์ "),t("code",[s._v("vendor")]),s._v(" เกิดขึ้นในตำแหน่งที่เราต้องการ")]),s._v(" "),t("p",[t("em",[s._v("Path")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n|-composer.json\n+-php\n|   +-src\n|   |   |-index.php\n|   |   +-vendor\n")])])]),t("p",[s._v("ซึ่งการบันทึกข้อมูล Dependencies ที่ได้ถูกติดตั้งไว้กับโปรเจค ยังคงถูกบันทึกไว้ที่ไฟล์ "),t("code",[s._v("composer.json")]),s._v(" ในตำแหน่ง Root Path")]),s._v(" "),t("p",[t("em",[s._v("composer.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n{\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"config"')]),s._v(": {\n        "),t("span",{staticClass:"hljs-attr"},[s._v('"vendor-dir"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"php/src/vendor"')]),s._v("\n    },\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"require"')]),s._v(": {\n        "),t("span",{staticClass:"hljs-attr"},[s._v('"slim/slim"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"^3.9"')]),s._v("\n    }\n}\n")])])]),t("h3",{attrs:{id:"ทดสอบ"}},[s._v("ทดสอบ")]),s._v(" "),t("p",[s._v("ลองทดสอบการเรียกใช้ Dependencies โดยทดลองเขียนโค้ด PHP ง่ายๆ ตามตัวอย่างด้านล่าง")]),s._v(" "),t("p",[t("em",[s._v("php/src/index.php")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-meta"},[s._v("<?php")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("require")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("__DIR__")]),s._v(" . "),t("span",{staticClass:"hljs-string"},[s._v("'/vendor/autoload.php'")]),s._v(";\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("use")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("Slim")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v(";\n\n$app = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" App;\n\nvar_dump($app);\n")])])]),t("h3",{attrs:{id:"ปัญหาที่จะตามมาคือการใช้งาน-autoload"}},[s._v("ปัญหาที่จะตามมาคือการใช้งาน Autoload")]),s._v(" "),t("p",[s._v("สมมุติผมต้องการจะมีไฟล์ "),t("code",[s._v("HomeController.php")]),s._v(" ตามโครงสร้างด้านล่าง")]),s._v(" "),t("p",[t("em",[s._v("Path")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n|-composer.json\n+-php\n|   +-src\n|   |   |-index.php\n|   |   +-app\n|   |   |   +-Controllers\n|   |   |   |   |-HomeController.php\n|   |   +-vendor\n")])])]),t("p",[s._v("ซึ่งผมจะใช้การทำ Autoload แบบ "),t("code",[s._v("psr-4")]),s._v(" เพื่อรองรับการใช้งาน "),t("code",[s._v("namespace")])]),s._v(" "),t("p",[t("em",[s._v("php/src/app/Controllers/HomeController.php")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-meta"},[s._v("<?php")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("namespace")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("Controllers")]),s._v(";\n\n"),t("span",{staticClass:"hljs-class"},[t("span",{staticClass:"hljs-keyword"},[s._v("class")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("HomeController")]),s._v("\n")]),s._v("{\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("public")]),s._v(" "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("__construct")]),t("span",{staticClass:"hljs-params"},[s._v("()")]),s._v("\n    ")]),s._v("{\n        "),t("span",{staticClass:"hljs-keyword"},[s._v("echo")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'Hello World'")]),s._v(";\n    }\n}\n")])])]),t("p",[s._v("หากยังไม่มีการทำ Autoload โค้ด PHP ด้านล่างจะต้องแสดง Error อย่างแน่นอน")]),s._v(" "),t("p",[t("em",[s._v("php/src/index.php")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-meta"},[s._v("<?php")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("require")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("__DIR__")]),s._v(" . "),t("span",{staticClass:"hljs-string"},[s._v("'/vendor/autoload.php'")]),s._v(";\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("use")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("Slim")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("use")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("Controllers")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("BaseController")]),s._v(";\n\n$app = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" App;\n$c = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" BaseController;\n")])])]),t("p",[s._v("ซึ่งในการทำ Autoload นั้นเราจะเพิ่มไฟล์ "),t("code",[s._v("composer.json")]),s._v(" ไฟล์ที่ 2 ไว้ที่ Path ตามโครงสร้างด้านล่าง")]),s._v(" "),t("p",[t("em",[s._v("Path")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n|-composer.json\n+-php\n|   +-src\n|   |   |-composer.json\n|   |   |-index.php\n")])])]),t("p",[s._v("เขียนโค้ดในไฟล์ "),t("code",[s._v("composer.json")]),s._v(" ตามตัวอย่างด้านล่าง เพื่อตั้งค่า Autoload")]),s._v(" "),t("p",[t("em",[s._v("php/src/composer.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n{\n  "),t("span",{staticClass:"hljs-attr"},[s._v('"autoload"')]),s._v(": {\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"psr-4"')]),s._v(": {\n      "),t("span",{staticClass:"hljs-attr"},[s._v('"App\\\\"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"app"')]),s._v("\n    }\n  }\n}\n")])])]),t("h3",{attrs:{id:"composer-custom-script"}},[t("code",[s._v("composer")]),s._v(" Custom Script")]),s._v(" "),t("p",[s._v("ปัญหาตอนนี้คือหากเราใช้คำสั้ง "),t("code",[s._v("composer dump-autoload")]),s._v(" จากตำแหน่ง Root จะไม่มีผลใดๆ เกิดขึ้นเพราะ "),t("code",[s._v("composer")]),s._v(" จะอ่านเพียงแค่ไฟล์ "),t("code",[s._v("composer.json")]),s._v(" ในตำแหน่ง Working Directory เท่านั้น")]),s._v(" "),t("p",[s._v("ซึ่งเราสามารถจะทำการเปลี่ยน Working Directory ด้วยคำสั่ง "),t("code",[s._v("cd src/php")]),s._v(" ก่อนใช้คำสั่ง "),t("code",[s._v("composer dump-autoload")]),s._v(" ก็ย่อมได้ แต่มันคงเหมือนจะเป็นการถอยหลังนะสิ เราจึงจะแก้ปัญหานี้ด้วย "),t("code",[s._v("composer")]),s._v(" Custom Script")]),s._v(" "),t("p",[s._v("แก้ไขไฟล์ "),t("code",[s._v("composer.json")]),s._v(" โดยเพิ่มโค้ดส่วนของ "),t("code",[s._v("scripts")]),s._v(" Section ตามตัวอย่างด้านล่าง")]),s._v(" "),t("p",[t("em",[s._v("composer.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n{\n  "),t("span",{staticClass:"hljs-attr"},[s._v('"config"')]),s._v(": {\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"vendor-dir"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"php/src/vendor"')]),s._v("\n  },\n  "),t("span",{staticClass:"hljs-attr"},[s._v('"require"')]),s._v(": {\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"slim/slim"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"^3.9"')]),s._v("\n  },\n  "),t("span",{staticClass:"hljs-attr"},[s._v('"scripts"')]),s._v(": {\n    "),t("span",{staticClass:"hljs-attr"},[s._v('"autoload"')]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"cd php/src && @composer dump-autoload"')]),s._v("\n  }\n}\n")])])]),t("blockquote",[t("p",[s._v("การตั้งชื่อ Custom Script นั้นเราสามารถตั้งชื่ออะไรก็ได้ที่ไม่ไปซ้ำกับ Sub Command ของ "),t("code",[s._v("composer")]),s._v(" หากเราอยากดูว่า "),t("code",[s._v("composer")]),s._v(" มี Sub Command อะไรบ้าง สามารถดูได้คร่าวๆ จากคำสั่ง "),t("code",[s._v("composer --help")])])]),s._v(" "),t("p",[s._v("หลังจากแก้ไขโค้ดในไฟล์ "),t("code",[s._v("composer.json")]),s._v(" เรียบร้อยแล้ว เราก็สามารถเรียกใช้ Custom Script ได้จากตำแหน่ง Root Path ด้วยตัวอย่างคำสั่งด้านล่างได้เลย")]),s._v(" "),t("p",[t("em",[s._v("Terminal")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\ncomposer "),t("span",{staticClass:"hljs-built_in"},[s._v("autoload")]),s._v("\n")])])]),t("p",[s._v("เพียงแค่นี้เราก็สามารถกลับไปทดสอบโค้ด PHP ตามตัวอย่างข้างล่างได้อย่างไม่มี Error แล้วหล่ะ")]),s._v(" "),t("p",[t("em",[s._v("php/src/index.php")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{staticClass:"hljs"},[t("code",[s._v("\n"),t("span",{staticClass:"hljs-meta"},[s._v("<?php")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("require")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("__DIR__")]),s._v(" . "),t("span",{staticClass:"hljs-string"},[s._v("'/vendor/autoload.php'")]),s._v(";\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("use")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("Slim")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("use")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("App")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("Controllers")]),s._v("\\"),t("span",{staticClass:"hljs-title"},[s._v("BaseController")]),s._v(";\n\n$app = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" App;\n$c = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" BaseController;\n")])])]),t("h3",{attrs:{id:"บทสรุป"}},[s._v("บทสรุป")]),s._v(" "),t("p",[s._v("วิธีการที่ได้นำเสนอในบทความนี้ อาจจะมีการตั้งค่าที่ยุ่งย่างพอสมควร แต่เพื่อลดปัญหาในเรียกใช้คำสั่งผิดที่ ผู้เขียนคิดว่าเทคนิตนี้มีความคุ้มค่าที่จะทำ ซึ่งสุดท้ายเราสามารถทำเป็น Repository ไว้เพื่อใช้ในการ Scaffold โปรเจคที่จะเกิดขึ้นใหม่ต่อไป")]),s._v(" "),t("p",[s._v("อย่างไรก็ตามเทคนิคนี้ยังคงมีข้อจำกัดหากเราต้องการจะมีโปรเจค PHP มากกว่า 1 โปรเจค ภายใต้โปรเจค Docker เนื่องจากเราสามารถตั้งค่า Custom Path สำหรับ โฟลเดอร์ "),t("code",[s._v("vendor")]),s._v(" ได้เพียงค่าเดียวเท่านั้น")])])}],!1,null,null,null);a.default=l.exports}}]);